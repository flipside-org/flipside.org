<!DOCTYPE html>
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Using open source technology, Flipside builds web-based tools that help organisations create social impact." />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <meta property="og:site_name" content="Flipside" />

  <meta property="og:type" content="article" />

<meta property="og:title" content="Processing data for Open Spending - Flipside" />
<meta property="og:url" content="http://flipside.org/notes/non-bid-contracts-openspending/" />

  <meta property="og:description" content="Open Spending is a project from the Open Knowledge Foundation that aims to map financial transactions from governments around the world. This post describes how we added over 380.000 non-bid contracts from the Portuguese government to openspending.

" >


  <meta property="og:image" content="http://flipside.org/images/notes/openspending.png" />

<meta property="og:image" content="http://flipside.org/images/meta/og-image.png" />  
  <meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@flipside_org">

  <meta name="twitter:creator" content="@danielfdsilva">

<meta name="twitter:title" content="Processing data for Open Spending - Flipside">

  <meta property="twitter:description" content="Open Spending is a project from the Open Knowledge Foundation that aims to map financial transactions from governments around the world. This post describes how we added over 380.000 non-bid contra..." >


  
    <meta property="twitter:image" content="http://flipside.org/images/notes/openspending.png" />
  

  
  <link rel="shortcut icon" href="http://flipside.org/images/meta/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="http://flipside.org/images/meta/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="http://flipside.org/images/meta/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="http://flipside.org/images/meta/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="http://flipside.org/images/meta/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="http://flipside.org/images/meta/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="http://flipside.org/images/meta/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="http://flipside.org/images/meta/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="http://flipside.org/images/meta/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="http://flipside.org/images/meta/apple-touch-icon-152x152.png" />
  
  <title>Flipside - Processing data for Open Spending</title>
  
  <link type="text/plain" rel="author" href="http://flipside.org/humans.txt" />
  <link rel="stylesheet" href="/css/app.css">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,400italic,700' rel='stylesheet' type='text/css'>
  <link rel="alternate" type="application/rss+xml" title="Flipside" href="http://flipside.org/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-33134074-1', 'flipside.org');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <!--[if lt IE 9]>
    <div id="nocando">
      <h1>Your browser is not supported.</h1>
      <p>To view this website, we recommend using the <strong>latest version</strong> of Chrome, Safari or Firefox.</p>
      <p>Here: <a href="http://browsehappy.com/" title="Visit Broser happy">upgrade your browser</a>!</p>
    </div>
  <![endif]-->
  
  <div id="site-canvas">
    <header id="site-hdr" role="banner">
      <div class="row">
        <h1 id="site-title">
          <a href="http://flipside.org" title="Go home"><img src="/images/flipside-logo.svg" alt="Flipside logo" title="Flipside" /><span class="visually-hidden">Flipside</span></a>
        </h1>
        <nav id="primary" role="navigation">
	<a href="#nav-links" class="toggle"><span class="visually-hidden">Menu</span></a>
	<ul class="links" id="nav-links">
    
    <li>
    
			<a href="/" title="Go home">Home</a>
		</li>
		
    <li>
    
			<a href="/projects/" title="Project hub">Projects</a>
		</li>
		
		<li>
		
			<a href="/notes/" title="Notes hub">Notes</a>
		</li>
		
    <li>
    
			<a href="/about/" title="About Flipside">About</a>
		</li>
		
    <li>
    
			<a href="/contact/" title="Contact page">Contact</a>
		</li>
	</ul>
</nav>
      </div>
    </header>

    <main id="site-body" role="main">
      








<article class="has-sidebar">

  
  <header class="banner" style="background-color: #6A9B4A;">
  
  	<div class="row">
    	<div class="heading">
        <h1 class="title">Processing data for Open&nbsp;Spending</h1>
        <h2 class="section-title"><em>Under</em> Notes</h2>
      </div>
    	<div class="actions">
        <ul class="notes-navigation">
          <li id="social-share">
  <a class="toggle share" href="#share-links"><span>Social share</span></a>
  <ul class="links" id="share-links">
    <li class="facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://flipside.org/notes/non-bid-contracts-openspending/" target="_blank" class="facebook" title="Share this on Facebook">Facebook</a>
    </li>
    <li class="twitter">
      <a href="https://twitter.com/share?url=http://flipside.org/notes/non-bid-contracts-openspending/" target="_blank" class="twitter" title="Share this on Twitter">Twitter</a>
    </li>
    <li class="google-plus">
      <a href="https://plus.google.com/share?url=http://flipside.org/notes/non-bid-contracts-openspending/" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600'); return false;" class="google-plus" title="Share this on Google+">Google+</a>
    </li>
  </ul>
</li>
          <li>
          
            <a href="/notes/twitter-streams/" title="Previous note" class="previous"><span class="visually-hidden">previous</span></a>
          
          </li>
          <li>
          
            <a href="/notes/launch-incendios2/" title="Next note" class="next"><span class="visually-hidden">next</span></a>
          
          </li>
        </ul>
      </div>
    </div>
  </header>

 	<div class="row">
		<div class="content">
      <p><a href="https://openspending.org/">Open Spending</a> is a project from the Open Knowledge Foundation that aims to map financial transactions from governments around the world. This post describes how we added over <a href="https://openspending.org/pt_ajustes-diretos/">380.000</a> non-bid contracts from the Portuguese government to openspending.</p>

<p>Even though the data on non-bid expenditures from the Portuguese government is already publicly available on <a href="http://www.base.gov.pt">Base.gov.pt</a>, the data on Open Spending is much more accessible. People can explore and browse the set in the browser, or use the API to create visualizations or other insights.</p>

<h2 id="processing-the-data">Processing the data</h2>
<p>To prepare the data for import, we use python to process a file with one JSON document per line and turn it into a CSV. The most important things the scripts handles, are:</p>

<ul>
  <li>all dates are formatted to <code>yyyy-mm-dd</code>;</li>
  <li>whenever the <code>signing date</code> is empty, the field is populated with the <code>publication date</code>. Openspending discards any row with empty calls;</li>
  <li>the fields containing amounts are stripped from Euro sign and the thousand separator. The decimal mark is set to <code>.</code>;</li>
  <li>the CPV code is split from its description;</li>
  <li>multiple locations are split with a pipe; and</li>
  <li>multiple contracting or contracted entities are combined in one new entity.</li>
</ul>

<h3 id="multiple-contracting-or-contracted-entities">Multiple contracting or contracted entities</h3>
<p>Open Spending doesn’t support multiple contracting or contracted entities for one record. The format used for importing is csv and since it has a flat structure it doesn’t allow multidimensional values.<br />
To solve this problem we have two options:
- split the contracting and contracted entities creating a contract for each one and dividing the total amount by the number of entities. This would lead to several duplicate contracts and erroneous amounts since not every contracted company will be paid the same.
- keep one single contract and merge the entities. The problem with this approach is that analysis of relationships between entities become more difficult.</p>

<p>We chose the latter approach so the contract maintains its integrity. Users that want to further analyse the dataset, will always be able to preprocess the data and split entities before doing so.</p>

<p>You can check the code for yourself on the processors’ Github <a href="https://github.com/flipside-org/ajustes-processor">repository</a>.</p>

<h2 id="creating-the-model">Creating the model</h2>
<p>Besides preparing the CSV file for import, Open Spending also requires people to create a model for the dataset. We decided to add as much information as possible, even though we were forced to leave out some potentially interesting data regarding amounts actually spent. Since not all contracts contain these amounts and Open Spending discards rows with empty dates or floats, we decided to not include them in the model just yet. Check the model on <a href="https://openspending.org/pt_ajustes-diretos/model.json">openspending.org</a>.</p>

    </div>
    <aside role="complementary">
      <section class="details">
        <h1>Details</h1>
        <dl>
          <dt class="visually-hidden">Author</dt>
          <dd class="bfc-objects">
            <a href="/about#team" title="Team page">
              <div class="media">
                <img src="/images/team/daniel-thumb-224x224-ec4565.jpg" class="thumb" >
              </div>
              <div class="teaser">
                <h2>Daniel Silva</h2>
                <p class="meta">Developer</p>
              </div>
            </a>
          </dd>
          
          
            
            
            
            <dt>Published</dt>
            <dd>04 Dec. 2013 <em>in</em> <a href="" title="" title="More in this category"></a></dd>
          
        </dl>
      </section>
      
        






      <section class="related-content">
        <h1>Related content</h1>
        <ul class="bfc-objects">
          
              <li>
                <article>
                  <a href="/notes/launch-incendios2/">
                    <div class="media">
                      <img src="/images/notes/incendios-pt-224x224-3a9fce.png" class="thumb" >
                    </div>
                    <div class="teaser">
                      <h1>Incendios 0.2 - more and improved data</h1>
                      <p class="meta"><em>Under</em> Notes</p>
                    </div>
                  </a>
                </article>
              </li>
            
          
        </ul>
      </section>

      
    </aside>
  </div>

</article>
    </main>

    
    
    <footer id="site-ftr" role="contentinfo">
        <div class="row">
          <div class="social">
            <ul>
              <li class="twitter"><a href="http://twitter.com/flipside_org" title="Flipside on Twitter" target="_blank"><span class="visually-hidden">Twitter</span></a></li>
              <li class="github"><a href="http://github.com/flipside-org" title="Flipside on Github" target="_blank"><span class="visually-hidden">Github</span></a></li>
              <li class="flickr"><a href="http://flickr.com/photos/flipside-org" title="Flipside on Flickr" target="_blank"><span class="visually-hidden">Flickr</span></a></li>
            </ul>
          </div>
          <p class="about">
            <span class="fs">Flipside 2014 </span> 
            <a href="/about#colophon" class="cta-inline" title="Colophon">Colophon</a>
          </p>
        </div>
    </footer>
  </div>
  <script src="/scripts/foundation.min.js"></script>
  <script src="/scripts/flipside.min.js"></script>
</body>
</html>